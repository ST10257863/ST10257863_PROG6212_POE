@*
 * Author: Jamie Parker - ST10257863
 * Date: 10 September 2024
 * Project: Contract Monthly Claim System (CMCS)
 *
 * Reference(s):
 * - Microsoft. (2023). Introduction to ASP.NET Core.
 *   Retrieved from https://learn.microsoft.com/en-us/aspnet/core/introduction-to-aspnet-core?view=aspnetcore-8.0
 *   [Accessed: 10 September 2024].
 *@
@{
	ViewData["Title"] = "Claims";
}
<link rel="stylesheet" href="~/css/styles.css" />

<div class="container">
	<div class="background center-content gap-32">
		<!-- Form Section -->
		<form id="claims-form" method="post" action="/Claims/Claims" enctype="multipart/form-data" class="flex-column center-content gap-32">
			<!-- Input Fields Frame -->
			<div class="flex-column gap-32 center-content">

				<!-- Hours Worked Input -->
				<div class="input-field">
					<label for="hoursWorked" class="text-bold">Hours Worked</label>
					<input type="text" id="hoursWorked" name="hoursWorked" class="input-box" placeholder="Enter hours worked" aria-label="Hours Worked" />
				</div>

				<!-- Overtime Worked Input -->
				<div class="input-field">
					<label for="overtimeWorked" class="text-bold">Overtime Worked</label>
					<input type="text" id="overtimeWorked" name="overtimeWorked" class="input-box" placeholder="Enter overtime worked" aria-label="Overtime Worked" />
				</div>

				<!-- Document Upload -->
				<div class="input-field">
					<label for="document" class="text-bold">Upload Document</label>
					<input type="file" id="document" name="document" class="input-box" aria-label="Upload Document" />
				</div>
			</div>

			<!-- Calculation Results -->
			<div class="center-content-start">
				<div class="flex-row center-content-start">
					<div class="flex-column gap-32">
						<label for="regularPay" class="text-bold">Regular Pay:</label>
						<label for="overtimePay" class="text-bold">Overtime Pay:</label>
						<label for="totalPay" class="text-bold">Total Pay:</label>
					</div>
					<div class="flex-column gap-32">
						<div id="regularPay" class="text-regular regular-pay-number"> </div>
						<div id="overtimePay" class="text-regular regular-pay-number"> </div>
						<div id="totalPay" class="text-regular regular-pay-number"> </div>
					</div>
				</div>
			</div>

			<!-- Action Buttons -->
			<div class="flex-row gap-32 center-content">
				<button type="button" id="calculate-btn" class="submit-button text-bold">Calculate Pay</button>
				<button type="submit" form="claims-form" class="submit-button text-bold">Submit Claim</button>
			</div>
		</form>

		<!-- Lecturer Details Frame -->
		<div class="center-content-start gap-32 padding-top-16">
			<div class="flex-row center-content-start">
				<!-- Labels -->
				<div class="flex-column gap-32">
					<label for="lectureId" class="text-bold">Lecture ID:</label>
					<label for="userName" class="text-bold">User Name:</label>
					<label for="fullName" class="text-bold">Full Name:</label>
					<label for="hourlyRate" class="text-bold">Hourly Rate:</label>
					<label for="department" class="text-bold">Department:</label>
					<label for="campus" class="text-bold">Campus:</label>
				</div>

				<!-- Content -->
				<div class="flex-column gap-32">
					<div id="lectureId" class="text-regular">N/A</div>
					<div id="userName" class="text-regular">N/A</div>
					<div id="fullName" class="text-regular">N/A</div>
					<div id="hourlyRate" class="text-regular">N/A</div>
					<div id="department" class="text-regular">N/A</div>
					<div id="campus" class="text-regular">N/A</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function () {
		// Fetch User ID from session and load lecturer details
		$.ajax({
			url: '/Claims/GetLecturerDetails',  // Ensure this URL is correct
			method: 'GET',
			success: function (data) {
				console.log('User ID data:', data); // Log data for debugging
				if (data) {  // Check if data was received
					loadLecturerDetails(data);
				} else {
					console.error('User ID not found in session');
				}
			},
			error: function (err) {
				console.error('Error fetching User ID:', err);
			}
		});

		function loadLecturerDetails(data) {
			// Use the data received from the first AJAX call
			console.log('Lecturer Details:', data); // Debugging to see the data structure
			if (data) {
				$('#lectureId').text(data.lecturerId || 'N/A');
				$('#userName').text(data.userName || 'N/A');
				$('#fullName').text((data.firstName || 'N/A') + ' ' + (data.lastName || 'N/A'));
				$('#hourlyRate').text('R' + (data.hourlyRate || 0) + '/hr'); // Make sure the currency symbol is consistent
				$('#department').text(data.department || 'N/A');
				$('#campus').text(data.campus || 'N/A');
			} else {
				// Handle case when no data is returned
				$('#lectureId').text('N/A');
				$('#userName').text('N/A');
				$('#fullName').text('N/A');
				$('#hourlyRate').text('N/A');
				$('#department').text('N/A');
				$('#campus').text('N/A');
			}

			// Calculate Pay button click handler should be outside of this function
			handleCalculatePay();
		}

		function handleCalculatePay() {
			// Handle Calculate Pay button click
			$('#calculate-btn').on('click', function () {
				// Get input values
				var hoursWorked = parseFloat($('#hoursWorked').val()) || 0; // Default to 0 if NaN or empty
				var overtimeWorked = parseFloat($('#overtimeWorked').val()) || 0; // Default to 0 if NaN or empty

				// Parse hourlyRate and handle empty or invalid cases
				var hourlyRateText = $('#hourlyRate').text().replace('R', '').replace('/hr', '').trim();
				var hourlyRate = parseFloat(hourlyRateText) || 0; // Default to 0 if NaN or empty

				console.log('Hours Worked:', hoursWorked); // Debugging output
				console.log('Overtime Worked:', overtimeWorked); // Debugging output
				console.log('Hourly Rate:', hourlyRate); // Debugging output

				// Calculate pay based on the values
				var regularPay = hoursWorked * hourlyRate;
				var overtimePay = overtimeWorked * (hourlyRate * 1.5); // Assuming 1.5x for overtime
				var totalPay = regularPay + overtimePay;

				// Update the results in the respective divs
				$('#regularPay').text('R' + regularPay.toFixed(2));
				$('#overtimePay').text('R' + overtimePay.toFixed(2));
				$('#totalPay').text('R' + totalPay.toFixed(2));
			});
		}
	});
</script>

